#! /usr/bin/ruby

require 'elf'
require 'yaml'

$config = 'db.yaml'

$config = YAML.load_file($config)
$config['logger'] = $logger

ActiveRecord::Base.establish_connection($config)

$dbh = ActiveRecord::Base.connection.connection
Elf::DatabaseObject.dbh = $dbh


invoices = Elf::Invoice.find(:all, :conditions => "id >= #{start}")

Elf::CardBatch.transaction do 
	batch = Elf::CardBatch.new(:date => Date.today)
	invoices.each do |i|
		batch.items << Elf::CardBatchItem.from_invoice(i) if i.account.customer.cardnumber
	end
	batch.save!
end
